"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(a,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function r(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,r)}c((o=o.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{let e=!1;const t=e=>{return e.returnValue="You have unsaved changes that may be lost.","You have unsaved changes that may be lost."},n=e=>{const t=document.createElement("div");t.className="modal is-active";const n=e.contextualColorName||"info",o=e.titleString||"",a=e.bodyHTML||"",i=e.cancelButtonHTML||"Cancel",s=e.okButtonHTML||"OK";t.innerHTML='<div class="modal-background"></div><div class="modal-content"><div class="message is-'+n+'"><header class="message-header"><span class="is-size-5"></span></header><section class="message-body">'+(""===a?"":'<div class="mb-4">'+a+"</div>")+'<div class="buttons is-block has-text-right">'+(e.hideCancelButton?"":'<button class="button is-cancel-button" type="button" aria-label="Cancel">'+i+"</button>")+'<button class="button is-ok-button is-'+n+'" type="button" aria-label="OK">'+s+"</button></div></section></div></div>",t.querySelector(".message-header").querySelector("span").innerText=o,e.hideCancelButton||t.querySelector(".is-cancel-button").addEventListener("click",()=>{t.remove()});const r=t.querySelector(".is-ok-button");r.addEventListener("click",()=>{t.remove(),e.callbackFn&&e.callbackFn()}),document.body.insertAdjacentElement("beforeend",t),r.focus()},o=document.querySelector("meta[name='csrf-token']"),a=o?o.getAttribute("content"):"",i={clearElement:e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},escapeHTML:e=>String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),dateToString:e=>e.getFullYear().toString()+"-"+("0"+(e.getMonth()+1).toString()).slice(-2)+"-"+("0"+e.getDate().toString()).slice(-2),dateStringToDate:e=>{const t=e.split("-");return new Date(parseInt(t[0],10),parseInt(t[1],10)-1,parseInt(t[2],10))},dateStringDifferenceInDays:(e,t)=>{const n=i.dateStringToDate(e),o=i.dateStringToDate(t);return Math.round((o.getTime()-n.getTime())/864e5)},responseToJSON:e=>__awaiter(void 0,void 0,void 0,function*(){return yield e.json()}),postJSON:(e,t,n)=>{const o={credentials:"same-origin",headers:{"CSRF-Token":a},method:"POST"};if(t)if(t instanceof HTMLFormElement){const e=t;e.querySelector("input[name][type='file']")?o.body=new FormData(e):o.body=new URLSearchParams(new FormData(e))}else t instanceof Object&&(o.headers["Content-Type"]="application/json",o.body=JSON.stringify(t));window.fetch(e,o).then(i.responseToJSON).then(n).catch(()=>{i.alertModal("Error","Error communicating with the server.","OK","danger")})},showModal:e=>{e.classList.add("is-active")},hideModal:e=>{let t=e;t instanceof Event&&(t=e.currentTarget),(t.classList.contains("modal")?t:t.closest(".modal")).classList.remove("is-active")},htmlModalFolder:"/html/",openHtmlModal:(e,t)=>{window.fetch(i.htmlModalFolder+e+".html").then(e=>__awaiter(void 0,void 0,void 0,function*(){return yield e.text()})).then(e=>__awaiter(void 0,void 0,void 0,function*(){const n=document.createElement("div");n.innerHTML=e;const o=n.querySelector(".modal");document.body.insertAdjacentElement("beforeend",n),(null==t?void 0:t.onshow)&&t.onshow(o),o.classList.add("is-active");const a=()=>{const e=o.classList.contains("is-active");if((null==t?void 0:t.onhide)&&e){if(t.onhide(o))return}o.classList.remove("is-active"),(null==t?void 0:t.onhidden)&&e&&t.onhidden(o),n.remove(),(null==t?void 0:t.onremoved)&&t.onremoved()};(null==t?void 0:t.onshown)&&t.onshown(o,a);const i=o.getElementsByClassName("is-close-modal-button");for(const e of i)e.addEventListener("click",a)})).catch(()=>{i.alertModal("Error","Error loading popup.","OK","danger")})},enableNavBlocker:()=>{e||(window.addEventListener("beforeunload",t),e=!0)},disableNavBlocker:()=>{e&&(window.removeEventListener("beforeunload",t),e=!1)},isNavBlockerEnabled:()=>e,confirmModal:(e,t,o,a,i)=>{n({bodyHTML:t,callbackFn:i,contextualColorName:a,okButtonHTML:o,titleString:e})},alertModal:(e,t,o,a)=>{n({bodyHTML:t,contextualColorName:a,hideCancelButton:!0,okButtonHTML:o,titleString:e})}};window.cityssm=window.cityssm||i})();